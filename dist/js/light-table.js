class LightTable{constructor(i){var t={selector:"table",stickyHead:!1,search:!1,pagination:!1,paginationPerPage:10,theme:"black",print:!1,exportCSV:!1,exportCSVFileName:"",charts:[],labels:{print:"Print",exportCSV:"Export CSV",searchAnyThing:"Search any thing"}},t=(t.exportCSVFileName="light table export "+(new Date).toDateString(),this.options={...t,...i},this.labels=this.options.labels,document.querySelectorAll(this.options.selector));0!=t.length&&t.forEach(t=>{var e=Math.floor(1e3*Math.random())+1+(Math.floor(100*Math.random())+1);let a=document.createElement("div");a.setAttribute("data-id","lt-table-"+e),a.setAttribute("data-pagination",this.options.pagination?"yes":"no"),a.setAttribute("data-pagination_items",this.options.paginationPerPage),a.setAttribute("data-sort",0),a.setAttribute("data-sort_type",1),t.parentNode.insertBefore(a,t),a.classList.add("lt-table"),a.classList.add("lt-"+this.options.theme);var l=document.createElement("div"),r=(l.classList.add("lt-table-header"),a.appendChild(l),document.createElement("div")),r=(r.classList.add("lt-table-table"),r.innerHTML=t.outerHTML,a.appendChild(r),document.createElement("div")),n=(r.classList.add("lt-table-footer"),a.appendChild(r),document.createElement("div")),e=(n.classList.add("lt-table-charts"),a.appendChild(n),t.setAttribute("data-id","lt-table-"+e),t.style.display="none",t.setAttribute("id","lt-table-hidden-"+e),this.options.stickyHead&&a.classList.add("lt-sticky"),this.options.search&&(n=Math.floor(1e3*Math.random())+1,(t=document.createElement("div")).classList.add("lt-table-search"),t.innerHTML='<label for="lt-table-search'+n+'">'+this.labels.searchAnyThing+':</label><input type="text" id="lt-table-search'+n+'" name="lt-table-search'+n+'" />',l.appendChild(t),a.querySelectorAll(".lt-table-search input").forEach(t=>{t.addEventListener("input",LightTable.#inputChanged)})),document.createElement("div"));e.classList.add("lt-table-actions"),l.appendChild(e),this.options.print&&LightTable.#print(e,this.labels),this.options.exportCSV&&LightTable.#exportCSV(e,this.labels,this.options),this.options.pagination&&((n=document.createElement("div")).classList.add("lt-table-pagination"),n.innerHTML="",r.appendChild(n),LightTable.#reloadData(a,1)),a.querySelectorAll('th[data-sortable="yes"]').forEach(t=>{t.addEventListener("click",function(t){var e=t.target.parentElement.parentElement.parentElement.parentElement.parentElement,t=t.target,t=[...t.parentNode.children].indexOf(t),t=(e.setAttribute("data-sort",t),1===parseInt(e.dataset.sort_type)?2:1);e.setAttribute("data-sort_type",t),LightTable.#reloadData(e,1)})}),0<i.charts.length&&i.charts.forEach(t=>{LightTable.#loadChart(a,t)})})}static#exportCSV(t,e,c){var a=document.createElement("button");a.classList.add("lt-table-actions-exportcsv"),a.innerHTML="<span>"+e.exportCSV+"</span>",t.appendChild(a),a.addEventListener("click",function(t){for(var e=t.target.parentElement.parentElement.parentElement.parentElement,t=(t.target,e.querySelectorAll("table")[0]),a=e.querySelectorAll(".lt-table-toggle-pagination.current")[0].dataset.page,l=(LightTable.#doSearch(e),[]),r=t.querySelectorAll("tr"),n=0;n<r.length;n++){for(var i=r[n].querySelectorAll("td,th"),o=[],s=0;s<i.length;s++)o.push(i[s].innerHTML);l.push(o.join(","))}var l=l.join("\n"),t=new Blob([l],{type:"text/csv"}),d=document.createElement("a"),t=(d.download=c.exportCSVFileName+".csv",window.URL.createObjectURL(t));d.href=t,d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),LightTable.#doSort(e),LightTable.#goToPage(e,a)})}static#print(t,e){var a=document.createElement("button");a.classList.add("lt-table-actions-print"),a.innerHTML="<span>"+e.print+"</span>",t.appendChild(a),a.addEventListener("click",function(t){var e=t.target.parentElement.parentElement.parentElement.parentElement.parentElement,t=(t.target,e.querySelectorAll("table")[0]),e=window.open("","PRINT","height=1000,width=1200");e.document.write("<html><head><title>"+document.title+"</title>"),e.document.write("</head><body >");return e.document.write("<style>table{ border-collapse: collapse; }table th,table td {padding:5px; border: 1px solid #000;} table tbody *{ color: #000; } </style>"),e.document.write("<h1>"+document.title+"</h1>"),e.document.write(t.outerHTML),e.document.write("</body></html>"),e.document.close(),e.focus(),e.print(),!0})}static#reloadData(t,e){LightTable.#buildPagination(t),LightTable.#doSearch(t),LightTable.#doSort(t),LightTable.#goToPage(t,1)}static#doSort(t){let r=parseInt(t.dataset.sort);var e=parseInt(t.dataset.sort_type),t=t.querySelectorAll("table")[0];let a=[];const n=t.querySelectorAll("tbody tr");n.forEach(t=>{t=t.querySelectorAll("td:nth-child("+(r+1)+")")[0].textContent;a.push(t)}),a.every(function(t){return/^-?\d+$/.test(t)})?a.sort(function(t,e){return t-e}):a.sort(),2===e&&a.reverse(),(a=new Set(a)).forEach(l=>{n.forEach(t=>{var e,a=t.parentElement;t.querySelectorAll("td:nth-child("+(r+1)+")")[0].textContent===l&&((e=document.createElement("tr")).innerHTML=t.innerHTML,t.remove(),a.insertBefore(e,a.firstElementChild))})})}static#inputChanged(t){t=t.target.parentElement.parentElement.parentElement;LightTable.#reloadData(t,1)}static#goToPage(t,e){t.dataset.id;var a=parseInt(t.dataset.pagination_items),l=document.querySelectorAll('.lt-table[data-id="'+t.dataset.id+'"] table')[0];document.querySelectorAll('table[data-id="'+t.dataset.id+'"]')[0],l.querySelectorAll("tbody")[0];let r=(e-=1)*a+1,n=r+a,i=0;t.querySelectorAll("table tbody tr").forEach(t=>{(++i<r||i>=n)&&t.remove()}),t.querySelectorAll(".lt-table-pagination button").forEach(t=>{t.classList.remove("current")}),t.querySelectorAll('.lt-table-pagination button[data-page="'+(e+1)+'"]')[0].classList.add("current")}static#buildPagination(t){t.dataset.id;var e=t.querySelectorAll(".lt-table-pagination")[0],a=document.querySelectorAll('.lt-table[data-id="'+t.dataset.id+'"] table')[0],l=t.dataset.pagination_items,t=(LightTable.#doSearch(t),a.querySelectorAll("tbody tr").length),r=Math.ceil(t/l);let n="";for(let t=1;t<=r;t++)n+='<button data-page="'+t+'" class="'+(1==t?"current":"")+' lt-table-toggle-pagination">'+t+"</button>";e.innerHTML=n;for(var i=e.querySelectorAll("button"),o=0;o<i.length;o++)i[o].addEventListener("click",function(t){var e=this.parentElement.parentElement.parentElement,a=this.dataset.page;LightTable.#doSearch(e),LightTable.#doSort(e),LightTable.#goToPage(e,a)},!1)}static#doSearch(t){t.dataset.id;var e=document.querySelectorAll('.lt-table[data-id="'+t.dataset.id+'"] table')[0],l=document.querySelectorAll('table[data-id="'+t.dataset.id+'"]')[0],e=e.querySelectorAll("tbody")[0];let r="";var a=t.querySelectorAll(".lt-table-search input").length;if(0==(r=0<a?t.querySelectorAll(".lt-table-search input")[0].value.toLowerCase():r).length)e.innerHTML=l.querySelectorAll("tbody")[0].outerHTML;else{let a=e.innerHTML="";l.querySelectorAll("tbody tr").forEach(t=>{let e="";t.querySelectorAll("td:not(.lt-exclude-search)").forEach(t=>{e+=" "+t.textContent.toLowerCase()}),e.includes(r)&&(a+=t.outerHTML)}),e.innerHTML=a}}static#loadChart(t,e){var a="lt-table-charts-"+(Math.floor(1e3*Math.random())+1),l=t.querySelectorAll(".lt-table-charts")[0],r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("id",a),l.appendChild(r);const n=[t,e,a];LightTable.#loadChartBars(n),window.addEventListener("resize",function(){LightTable.#loadChartBars(n)})}static#loadChartBars(t){var e=t[0];let a=t[1];var t=t[2],l=document.getElementById(t),t=document.querySelectorAll('table[data-id="'+e.dataset.id+'"]')[0].querySelectorAll("tbody tr");l.innerHTML="";let r=[];if(t.forEach((t,e)=>{console.log(t.querySelectorAll("td")[a.x]),void 0!==t.querySelectorAll("td")[a.x]&&void 0!==t.querySelectorAll("td")[a.y]&&(t={label:t.querySelectorAll("td")[a.x].textContent,value:t.querySelectorAll("td")[a.y].textContent},r.push(t))}),0==r.length)console.warn("data not found in table!");else{var e=r.map(function(t){return t.value}),n=Math.max(...e),i=a.hideAxis?l.clientWidth:l.clientWidth-60,o=a.hideAxis?l.clientHeight:l.clientHeight-60,s=(i-a.spacing*(r.length-1))/r.length,d=o/n;if(a.horizintalLines)for(let t=1;t<=n;t+=Math.round(n/a.axisScaleUnit)){var c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("transform","translate(30 30)"),c.setAttribute("x1",0),c.setAttribute("y1",o-t*d),c.setAttribute("x2",i),c.setAttribute("y2",o-t*d),c.setAttribute("stroke",a.horizintalLinesColors),c.setAttribute("stroke-width","1"),l.appendChild(c)}var h=document.createElementNS("http://www.w3.org/2000/svg","g");h.classList.add("lt-chart-visual"),a.hideAxis?h.setAttribute("transform","translate(0 0)"):h.setAttribute("transform","translate(30 30)"),h.setAttribute("width",i),h.setAttribute("height",o),l.appendChild(h);for(let t=0;t<r.length;t++){var u=document.createElementNS("http://www.w3.org/2000/svg","g"),p=(u.classList.add("lt-chart-item"),h.appendChild(u),r[t].value),b=p*d,g=s,m=t*(g+a.spacing),A=o-b,y=document.createElementNS("http://www.w3.org/2000/svg","rect");y.setAttribute("x",m),y.setAttribute("y",A),y.setAttribute("width",g),y.setAttribute("height",b),y.setAttribute("fill",a.color),u.appendChild(y),a.hover&&((y=document.createElementNS("http://www.w3.org/2000/svg","text")).classList.add("lt-chart-hover"),y.setAttribute("x",m+g/2),y.setAttribute("y",A+b/2),y.setAttribute("fill",a.hoverColor),y.setAttribute("text-anchor","middle"),y.textContent=p.toString(),u.appendChild(y)),a.hideLabel||((b=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("x",m+g/2),b.setAttribute("y",A-5),b.setAttribute("text-anchor","middle"),b.textContent=p.toString(),u.appendChild(b))}if(!a.hideAxis){var S=document.createElementNS("http://www.w3.org/2000/svg","g"),v=(S.classList.add("lt-chart-axis"),S.setAttribute("transform","translate(30 30)"),l.appendChild(S),s),t=document.createElementNS("http://www.w3.org/2000/svg","line"),e=(t.setAttribute("x1",0),t.setAttribute("y1",o),t.setAttribute("x2",i),t.setAttribute("y2",o),t.setAttribute("stroke","#787878"),t.setAttribute("stroke-width","1"),S.appendChild(t),document.createElementNS("http://www.w3.org/2000/svg","line"));e.setAttribute("x1",0),e.setAttribute("y1",0),e.setAttribute("x2",0),e.setAttribute("y2",o),e.setAttribute("stroke","#787878"),e.setAttribute("stroke-width","1"),S.appendChild(e);for(let t=0;t<r.length;t++){var w=document.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x",t*(v+a.spacing)+v/2),w.setAttribute("y",o+15),w.setAttribute("text-anchor","middle"),w.textContent=r[t].label,w.setAttribute("fill","#787878"),S.appendChild(w)}for(let t=0;t<=n;t+=Math.round(n/a.axisScaleUnit)){var L=document.createElementNS("http://www.w3.org/2000/svg","text");L.setAttribute("x",-5),L.setAttribute("y",o-t*d),L.setAttribute("text-anchor","end"),L.setAttribute("alignment-baseline","middle"),L.textContent=t.toString(),L.setAttribute("fill","#787878"),S.appendChild(L)}}}}}